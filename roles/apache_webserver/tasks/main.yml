---
- name: Install Apache (httpd) package
  ansible.builtin.dnf:
    name: httpd
    state: present

- name: Install firewalld if not present
  ansible.builtin.dnf:
    name: firewalld
    state: present

- name: Ensure firewalld is started and enabled
  ansible.builtin.systemd:
    name: firewalld
    state: started
    enabled: true

- name: Create index.html from template
  ansible.builtin.template:
    src: index.html.j2
    dest: /var/www/html/index.html
    owner: root
    group: root
    mode: '0644'
  notify: Reload httpd

- name: Ensure SELinux context is correct for web content
  ansible.builtin.command: restorecon -Rv /var/www/html
  changed_when: false
  when: ansible_selinux.status == "enabled"

- name: Start and enable httpd service
  ansible.builtin.systemd:
    name: httpd
    state: started
    enabled: true

- name: Open firewall port 80 (http)
  ansible.posix.firewalld:
    service: http
    permanent: true
    state: enabled
    immediate: true

- name: Gather network facts
  ansible.builtin.setup:
    gather_subset:
      - network

- name: Display server access information
  ansible.builtin.debug:
    msg: |
      ========================================
      Apache Web Server Setup Complete!
      ========================================
      
      Your web server is now running and accessible at:
      
      {% if use_ip_address %}
      ğŸŒ http://{{ ansible_default_ipv4.address }}
      {% else %}
      ğŸŒ http://{{ ansible_fqdn }}
      {% if ansible_fqdn != ansible_hostname %}
      ğŸŒ http://{{ ansible_hostname }}
      {% endif %}
      ğŸŒ http://{{ ansible_default_ipv4.address }}
      {% endif %}
      
      Server Details:
      - Hostname: {{ ansible_hostname }}
      - FQDN: {{ ansible_fqdn }}
      - IP Address: {{ ansible_default_ipv4.address }}
      - Distribution: {{ ansible_distribution }} {{ ansible_distribution_version }}
      
      Firewall: Port 80 is OPEN
      Service: httpd is RUNNING and ENABLED
      
      ========================================
      Open a web browser and navigate to any of the URLs above!
      ========================================
